<div class="dashboard-container fade-in">
  <div class="dashboard-header">
    <h1 class="dashboard-title">My Dashboard</h1>
    <p class="dashboard-subtitle">Track your progress and performance across all tests</p>
  </div>

  <!-- Loading Account Status -->
  <div *ngIf="isLoadingAccountStatus" class="loading-spinner-container text-center my-3">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading account status...</span>
    </div>
    <p>Checking account status...</p>
  </div>

  <!-- Account Expired Message -->
  <div *ngIf="!isLoadingAccountStatus && authService.getRole() === 'student' && isAccountExpired" class="alert alert-warning account-status-alert my-3">
    <h4>Account Status</h4>
    <p>Your account has expired. While you can view your past attempts, you may not be able to start new tests. 
       Please <a [routerLink]="['/profile']">visit your profile</a> to check your subscription details.</p>
  </div>

  <div *ngIf="loading && !isLoadingAccountStatus" class="loading">Loading your attempts‚Ä¶</div>
  <div *ngIf="error && !isLoadingAccountStatus" class="error">{{ error }}</div>

  <table *ngIf="!loading && !error && attempts && attempts.length > 0 && !isLoadingAccountStatus">
    <thead>
      <tr>
        <th>Mock</th>
        <th>Score</th>
        <th>Out Of</th>
        <th>%</th>
        <th>Review</th>
        <th>Leaderboard</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let a of attempts">
        <td>{{ a?.series?.title || 'Unknown Test' }} ({{ a?.series?.year || 'N/A' }})</td>
        <td>{{ a?.score || 0 }}</td>
        <td>{{ a?.maxScore || 0 }}</td>
        <td>{{ a?.percentage || 0 }}%</td>
        <td>
          <a [routerLink]="['/review', a?._id]">Review</a>
        </td>
        <td>
          <a *ngIf="a?.series?.enablePublicLeaderboard" [routerLink]="['/leaderboard', a?.series?._id]">View</a>
          <span *ngIf="!a?.series?.enablePublicLeaderboard">N/A</span>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Empty state when there are no attempts -->
  <div *ngIf="!loading && !error && (!attempts || attempts.length === 0) && !isLoadingAccountStatus" class="empty-state">
    <div class="empty-icon">üìù</div>
    <h3 class="empty-title">No Test Attempts Yet</h3>
    <p class="empty-message">Take your first test to see your results here.</p>
    <a [routerLink]="['/tests']" class="empty-action">Browse Tests</a>
  </div>
</div>
