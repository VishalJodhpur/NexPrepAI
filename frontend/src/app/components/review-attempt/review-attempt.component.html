<button class="btn btn-outline-primary btn-sm mb-3" (click)="downloadPdf()">
  Download PDF scorecard
</button>

<div *ngIf="loading">Loading review data...</div>
<div *ngIf="error">{{ error }}</div>

<div *ngIf="!loading && !error && attempt && displayedSections.length > 0">
  <h2>Review: {{ attempt.series?.title || 'Test Series' }}</h2>
  
  <ng-container *ngFor="let section of displayedSections; let sectionIdx = index">
    <h3 class="mt-4 mb-3">{{ section.title }}</h3>
    <div *ngFor="let r of section.responses; let questionInSectionIdx = index">
      <h4>Q{{ getGlobalQuestionNumberForReview(sectionIdx, questionInSectionIdx) }}: {{ r.questionData?.questionText || 'Question text not available' }}
        <span *ngIf="r.review" class="material-icons-outlined flag-icon" title="Flagged for Review">flag</span> <!-- ADDED flag icon -->
      </h4>
      <p>Your answer:   {{ getAnswerText(r) }}</p>
      <p>Correct answer: {{ getCorrectText(r) }}</p>
      <p>Marks Earned: {{ r.earned }} / {{r.questionData?.marks}}</p>
      <hr />
    </div>
  </ng-container>

</div>

<div *ngIf="!loading && !error && (!attempt || displayedSections.length === 0)">
  No attempt data or sections found for review.
</div>
