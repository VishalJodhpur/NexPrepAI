<div class="container mt-4">
  <h2>Questions Pending Review</h2>

  <div *ngIf="isLoading" class="text-center">
    <p>Loading questions...</p>
    <!-- You can add a spinner or loading animation here -->
  </div>

  <div *ngIf="errorMessage" class="alert alert-danger">
    {{ errorMessage }}
  </div>

  <div *ngIf="!isLoading && !errorMessage && questions.length === 0" class="alert alert-info">
    No questions are currently pending review.
  </div>

  <div *ngIf="!isLoading && !errorMessage && questions.length > 0">
    <table class="table table-striped table-hover">
      <thead>
        <tr>
          <th>Question Text (English)</th>
          <th>Branch</th>
          <th>Subject</th>
          <th>Topic</th>
          <th>Difficulty</th>
          <th>Type</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let q of questions; let i = index">
          <tr>
            <td>
              {{ getQuestionText(q, 'en') }}
            </td>
            <td>{{ getHierarchyName(q.branch) }}</td>
            <td>{{ getHierarchyName(q.subject) }}</td>
            <td>{{ getHierarchyName(q.topic) }}</td>
            <td>{{ q.difficulty || 'N/A' }}</td>
            <td>{{ q.type || 'N/A' }}</td>
            <td>
              <button class="btn btn-outline-info btn-sm me-2" (click)="toggleDetails(q)" [title]="q.expanded ? 'Hide Details' : 'View Details'">
                <i [class.fas]="true" [class.fa-eye]="!q.expanded" [class.fa-eye-slash]="q.expanded"></i>
                <span class="ms-1">{{ q.expanded ? 'Hide' : 'Details' }}</span>
              </button>
              <button class="btn btn-outline-success btn-sm me-2" (click)="approveQuestion(getQuestionId(q))" [disabled]="!getQuestionId(q)" title="Approve">
                <i class="fas fa-check"></i>
                <span class="ms-1">Approve</span>
              </button>
              <button class="btn btn-outline-danger btn-sm" (click)="rejectQuestion(getQuestionId(q))" [disabled]="!getQuestionId(q)" title="Reject">
                <i class="fas fa-times"></i>
                <span class="ms-1">Reject</span>
              </button>
            </td>
          </tr>
          <tr *ngIf="q.expanded" class="question-details-row">
            <td [attr.colspan]="7"> <!-- Span across all columns -->
              <div class="question-details-container p-3">
                <h5 class="details-header">Full Question Details:</h5>
                <hr>
                <p><strong>Status:</strong> {{ q.status }}</p>
                <p><strong>Difficulty:</strong> {{ q.difficulty }}</p>
                <p><strong>Type:</strong> {{ q.type || 'N/A' }}</p>
                <p *ngIf="q.tags && q.tags.length > 0"><strong>Tags:</strong> {{ q.tags.join(', ') }}</p>
                <p *ngIf="q.recommendedTimeAllotment"><strong>Recommended Time:</strong> {{ q.recommendedTimeAllotment }} minutes</p>
                <p *ngIf="q.internalNotes"><strong>Internal Notes:</strong> {{ q.internalNotes }}</p>

                <div *ngFor="let translation of q.translations; let ti = index">
                  <h6>Translation ({{ translation.lang }})</h6>
                  <p [innerHTML]="translation.questionText"></p>
                  <div *ngIf="translation.images && translation.images.length > 0" class="mb-2">
                    <strong>Images:</strong>
                    <div class="d-flex flex-wrap">
                      <div *ngFor="let img of translation.images" class="me-2 mb-2">
                        <img [src]="img" alt="Question Image" style="max-width: 150px; max-height: 150px; border: 1px solid #ddd;">
                      </div>
                    </div>
                  </div>
                  <strong>Options:</strong>
                  <ul>
                    <li *ngFor="let option of translation.options" [class.correct-option]="option.isCorrect">
                      <span [innerHTML]="option.text"></span>
                      <span *ngIf="option.isCorrect"> (Correct)</span>
                      <div *ngIf="option.img" class="mt-1">
                        <img [src]="option.img" alt="Option Image" style="max-width: 100px; max-height: 100px; border: 1px solid #ddd;">
                      </div>
                    </li>
                  </ul>
                  <div *ngIf="translation.explanations && translation.explanations.length > 0">
                    <strong>Explanations:</strong>
                    <div *ngFor="let expl of translation.explanations" class="explanation-item mt-2 p-2 border rounded">
                      <p><strong>Label:</strong> {{ expl.label || 'General' }} (Type: {{ expl.type }})</p>
                      <div [ngSwitch]="expl.type">
                        <p *ngSwitchCase="'text'" [innerHTML]="expl.content"></p>
                        <a *ngSwitchCase="'video'" [href]="expl.content" target="_blank">View Video</a>
                        <a *ngSwitchCase="'pdf'" [href]="expl.content" target="_blank">View PDF</a>
                        <img *ngSwitchCase="'image'" [src]="expl.content" alt="Explanation Image" style="max-width: 200px; max-height: 200px; border: 1px solid #ddd;">
                      </div>
                    </div>
                  </div>
                  <hr *ngIf="ti < q.translations.length - 1">
                </div>

                <div *ngIf="q.explanations && q.explanations.length > 0 && q.translations.length === 0">
                    <h6>General Explanations (No specific translation):</h6>
                     <div *ngFor="let expl of q.explanations" class="explanation-item mt-2 p-2 border rounded">
                      <p><strong>Label:</strong> {{ expl.label || 'General' }} (Type: {{ expl.type }})</p>
                      <div [ngSwitch]="expl.type">
                        <p *ngSwitchCase="'text'" [innerHTML]="expl.content"></p>
                        <a *ngSwitchCase="'video'" [href]="expl.content" target="_blank">View Video</a>
                        <a *ngSwitchCase="'pdf'" [href]="expl.content" target="_blank">View PDF</a>
                        <img *ngSwitchCase="'image'" [src]="expl.content" alt="Explanation Image" style="max-width: 200px; max-height: 200px; border: 1px solid #ddd;">
                      </div>
                    </div>
                </div>

              </div>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>

    <!-- Pagination Controls -->
    <nav *ngIf="totalPages > 1" aria-label="Page navigation">
      <ul class="pagination justify-content-center">
        <li class="page-item" [class.disabled]="currentPage === 1">
          <button class="page-link" (click)="previousPage()">Previous</button>
        </li>
        <!-- Generate page numbers -->
        <li class="page-item" *ngFor="let pageNum of [].constructor(totalPages); let i = index" [class.active]="currentPage === i + 1">
          <button class="page-link" (click)="goToPage(i + 1)">{{ i + 1 }}</button>
        </li>
        <li class="page-item" [class.disabled]="currentPage === totalPages">
          <button class="page-link" (click)="nextPage()">Next</button>
        </li>
      </ul>
    </nav>
  </div>
</div>

<!-- Make sure you have Font Awesome or similar for icons if you use them -->
<!-- Add to your styles.scss or angular.json if not already present:
@import '~@fortawesome/fontawesome-free/css/all.min.css';
-->
