<h2>Filter Questions</h2>

<form (ngSubmit)="applyFilters()" #filterForm="ngForm" style="margin-bottom: 20px;">
  <!-- ADDED: Search Term Input -->
  <label>
    Search:
    <input type="text" [(ngModel)]="filters.searchTerm" name="searchTerm" placeholder="Enter search term...">
  </label>

  <label>
    Branch:
    <select [(ngModel)]="filters.branch" name="branch" (change)="onBranchChange()">
      <option value="">-- Select Branch --</option>
      <option *ngFor="let branch of branches" [value]="getIdValue(branch._id)">{{ branch.name }}</option>
    </select>
  </label>

  <label>
    Subject:
    <select [(ngModel)]="filters.subject" name="subject" (change)="onSubjectChange()" [disabled]="!filters.branch">
      <option value="">-- Select Subject --</option>
      <option *ngFor="let subject of subjects" [value]="getIdValue(subject._id)">{{ subject.name }}</option>
    </select>
  </label>

  <label>
    Topic:
    <select [(ngModel)]="filters.topic" name="topic" (change)="onTopicChange()" [disabled]="!filters.subject">
      <option value="">-- Select Topic --</option>
      <option *ngFor="let topic of topics" [value]="getIdValue(topic._id)">{{ topic.name }}</option>
    </select>
  </label>

  <label>
    Subtopic:
    <select [(ngModel)]="filters.subtopic" name="subtopic" (change)="onFilterChange()" [disabled]="!filters.topic">
      <option value="">-- Select Subtopic --</option>
      <option *ngFor="let subtopic of subtopics" [value]="getIdValue(subtopic._id)">{{ subtopic.name }}</option>
    </select>
  </label>

  <label>
    Difficulty:
    <select [(ngModel)]="filters.difficulty" name="difficulty" (change)="onFilterChange()">
      <option value="">-- All --</option>
      <option *ngFor="let level of difficultyLevels" [value]="level">{{ level }}</option>
    </select>
  </label>

  <label>
    Type:
    <select [(ngModel)]="filters.type" name="type" (change)="onFilterChange()">
      <option value="">-- All --</option>
      <option *ngFor="let type of questionTypes" [value]="type">{{ type }}</option>
    </select>
  </label>

  <label>
    Status:
    <select [(ngModel)]="filters.status" name="status" (change)="onFilterChange()">
      <option value="">-- All --</option>
      <option *ngFor="let status of questionStatuses" [value]="status">{{ status }}</option>
    </select>
  </label>

  <button type="submit">Apply Filters</button>
  <button type="button" (click)="resetFilters()">Reset Filters</button> <!-- MODIFIED: type="button" for reset -->
</form>

<h2>Question List</h2>

<table border="1" cellpadding="8" cellspacing="0">
  <thead>
    <tr>
      <th>Question Text (Primary)</th>
      <th>Languages</th>
      <th>Options (Summary)</th>
      <th>Type</th>
      <th>Status</th>
      <th>Difficulty</th>
      <th>Subject</th>
      <th>Topic</th>
      <th>Past History (Summary)</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let q of questions">
      <td>{{ q.displayQuestionText }}</td>
      <td>{{ getLanguageIndicator(q) }}</td>
      <td>{{ getOptionsSummary(q) }}</td>
      <td>{{ q.type }}</td>
      <td>{{ q.status }}</td>
      <td>{{ q.difficulty }}</td>
      <td>{{ getPopulatedFieldName(q.subject) || getIdValue(q.subject) }}</td>
      <td>{{ getPopulatedFieldName(q.topic) || getIdValue(q.topic) }}</td>
      <td>{{ getPastHistorySummary(q) }}</td>
      <td>
        <button (click)="editQuestion(getIdValue(q._id))">Edit</button>
        <button (click)="deleteQuestion(getIdValue(q._id))">Delete</button>
        <button (click)="viewQuestionDetails(getIdValue(q._id))">Full View</button> <!-- ADDED: Full View Button -->
      </td>
    </tr>
    <tr *ngIf="questions.length === 0">
      <td colspan="10">No questions found.</td> <!-- MODIFIED: colspan to match new column count -->
    </tr>
  </tbody>
</table>

<!-- Pagination Controls -->
<div *ngIf="totalPages > 0" class="pagination-controls">
  <button (click)="previousPage()" [disabled]="currentPage === 1">Previous</button>
  
  <ng-container *ngFor="let pageNum of getPageNumbers()">
    <button 
      (click)="handlePageClick(pageNum)" 
      [class.current-page]="pageNum === currentPage"
      [disabled]="pageNum === '...'">
      {{ pageNum }}
    </button>
  </ng-container>
  
  <button (click)="nextPage()" [disabled]="currentPage === totalPages">Next</button>
  
  <span class="page-info">Page {{ currentPage }} of {{ totalPages }} ({{ totalQuestions }} items)</span>
</div>

<style>
  .pagination-controls {
    margin-top: 20px;
    display: flex;
    align-items: center;
    gap: 5px;
  }
  .pagination-controls button.current-page {
    font-weight: bold;
    background-color: #007bff;
    color: white;
    border-color: #007bff;
  }
  .page-info {
    margin-left: 15px;
  }
</style>
